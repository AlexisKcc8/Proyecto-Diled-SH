---
import ContainerCenter from "@components/ContainerCenter.astro";

const problematics = [
  {
    titulo: "ğŸ  Â¡Tu casa no es inteligente, es desobediente!",
    text: "Luces encendidas todo el dÃ­a, electrodomÃ©sticos consumiendo energÃ­a sin controlâ€¦ Â¿Tu casa trabaja para ti o en tu contra?",
    urlImg: "/img/automatizacion.jpg",
  },
  {
    titulo: "ğŸ’¡ IluminaciÃ³n que arruina el ambiente",
    text: "Espacios oscuros cuando necesitas luz, reflejos molestos en la pantalla o una iluminaciÃ³n que no se ajusta a tu dÃ­aâ€¦ Â¿Te suena familiar?",
    urlImg: "/img/iluminacion.jpg",
  },
  {
    titulo: "ğŸ” Â¿Tu seguridad depende de la suerte?",
    text: "Salir de casa con la incertidumbre de si dejaste puertas abiertas o sin saber quÃ© pasa cuando no estÃ¡sâ€¦ Â¿QuÃ© tan seguro te sientes realmente?",
    urlImg: "/img/seguridad.jpg",
  },
  {
    titulo: "ğŸµ Sonido plano, aburrido y sin vida",
    text: "Altavoces con sonido pobre, mÃºsica que se corta o una acÃºstica que no aprovecha el espacioâ€¦ Â¿Tu audio estÃ¡ a la altura de la experiencia que mereces?",
    urlImg: "/img/audio.jpg",
  },
  {
    titulo: "ğŸ¬ Cine en casaâ€¦ pero sin la magia",
    text: "PelÃ­culas con mala calidad de imagen, sonido que no envuelve y un ambiente que no se siente como un cineâ€¦ Â¿Es realmente una experiencia inmersiva?",
    urlImg: "/img/cinema.jpg",
  },
  {
    titulo: "ğŸ“¹ CÃ¡maras que no ven cuando mÃ¡s lo necesitas",
    text: "Ãngulos ciegos, grabaciones de mala calidad o cÃ¡maras que fallan justo cuando mÃ¡s las necesitasâ€¦ Â¿Tu sistema de vigilancia es confiable?",
    urlImg: "/img/cctv.jpg",
  },
  {
    titulo: "ğŸ“¶ Internet que se cae en el peor momento",
    text: "Zonas sin seÃ±al, internet lento en el peor momento o desconexiones constantesâ€¦ Â¿Tu red te estÃ¡ saboteando?",
    urlImg: "/img/conectividad.jpg",
  },
];
---

<section class="w-full min-h-screen laptop:flex justify-center items-center">
  <ContainerCenter class="flex flex-col laptop:flex-row">
    <aside
      class="sticky z-30 bg-white top-0 w-{100%} h-[50vh] flex justify-center items-center shadow-lg shadow-[#fff] rounded-xl p-6 laptop:flex-1 laptop:w-{50%} laptop:h-[100vh]"
    >
      <div
        class="w-[80%] h-full rounded-2xl laptop:h-[90%] relative overflow-hidden"
      >
        <div class="w-full h-full overflow-hidden">
          <img
            id="dynamicImage"
            src={problematics[0].urlImg}
            alt="logo-diled"
            class="w-full h-full object-cover"
          />
        </div>
      </div>
    </aside>
    <aside class="flex-1 laptop:w-{50%}">
      {
        problematics.map((problematic, index) => (
          <div
            class="view-timeline-issues flex flex-col items-center justify-center text-center py-2 px-6 h-[50vh] laptop:h-[100vh] laptop:items-start laptop:text-start"
            data-img={problematic.urlImg}
            data-num-item={index + 1}
          >
            <h2 class="text-3xl font-bold text-diled-600 mb-4 laptop:text-5xl">
              {problematic.titulo}
            </h2>
            <p class="text-diled-gray laptop:text-xl">{problematic.text}</p>
          </div>
        ))
      }
    </aside>
  </ContainerCenter>
</section>
<style>
  .fade-in {
    animation: fadeIn 0.5s;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  .image-container {
    transition: opacity 0.5s;
  }
</style>
<!-- Script para cambiar la imagen al hacer scroll -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const sections = document.querySelectorAll(".view-timeline-issues");

    const imageElement = document.getElementById(
      "dynamicImage"
    ) as HTMLImageElement;

    if (!imageElement) {
      console.warn('Element with id "dynamicImage" not found.');
      return; // Salir si el elemento no se encuentra
    }
    const mobileThreshold = 1;
    const desktopThreshold = 0.5;

    const isMobile = window.matchMedia("(max-width: 768px)").matches;
    const threshold = isMobile ? mobileThreshold : desktopThreshold;
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const newImg = entry.target.getAttribute("data-img");
            const numItem = entry.target.getAttribute("data-num-item");
            if (newImg) {
              // Verificar que newImg no sea null
              imageElement.classList.add("fade-in");
              imageElement.classList.add("image-container");
              fadeIn(imageElement, newImg);
            }
          }
        });
      },
      { threshold }
    );

    sections.forEach((section) => observer.observe(section));
  });

  function fadeIn(element: HTMLImageElement, newImg: string) {
    element.style.opacity = "0";
    setTimeout(() => {
      element.src = newImg; // Ahora TypeScript reconoce 'src'
      element.style.opacity = "1";
    }, 300);
  }
</script>
